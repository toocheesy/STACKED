<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>STACKED!</title>
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#331E0F">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <!-- Quick Rules Overlay (first visit) -->
  <div id="quick-rules-overlay" class="quick-rules-overlay" style="display: none;">
    <div class="quick-rules-backdrop"></div>
    <div class="quick-rules-modal">
      <h2 class="quick-rules-heading">How to Play ðŸŽ´</h2>
      <div class="quick-rules-body">
        <p><strong>YOUR TURN:</strong> CAPTURE (turn continues) or PLACE (ends turn)</p>
        <p><strong>BUILDING COMBOS:</strong></p>
        <p>&#8226; Drag a card to <strong>BASE CARD</strong> slot first</p>
        <p>&#8226; Add to <strong>SUMS</strong> (3+7=10) or <strong>MATCH</strong> (K+K)</p>
        <p>&#8226; Must use cards from your hand AND the board</p>
        <p>&#8226; Hit <strong>Submit</strong> to capture</p>
        <p><strong>POINTS:</strong> A=15 | K,Q,J,10=10 | 2-9=5 each</p>
        <p><strong>TIPS:</strong> Face cards only match, never sum. Tap ðŸ’¡ if stuck.</p>
      </div>
      <button id="dismiss-rules-btn" class="dismiss-rules-btn">Deal Me In!</button>
    </div>
  </div>

  <!-- Force landscape orientation message -->
  <div class="orientation-overlay">
    ðŸ”„ Please rotate your device to landscape mode for the best STACKED! experience
  </div>

  <div class="game-container">
    <!-- Status Bar -->
    <div class="status-bar">
      <div class="player-stats">
        <div class="stat-block player-stat">
          <span class="stat-name">You</span>
          <span class="stat-score" id="player-score">0 pts</span>
        </div>
        <div class="stat-block bot1-indicator">
          <span class="stat-name" id="bot1-name">Bot 1</span>
          <span class="stat-score" id="bot1-score">0 pts</span>
          <span class="stat-cards" id="bot1-cards">4 cards</span>
        </div>
        <div class="stat-block bot2-indicator">
          <span class="stat-name" id="bot2-name">Bot 2</span>
          <span class="stat-score" id="bot2-score">0 pts</span>
          <span class="stat-cards" id="bot2-cards">4 cards</span>
        </div>
      </div>

      <div class="last-capture-display" id="last-capture-display"></div>

      <div class="top-right-info">
        <button class="action-btn rules-btn" id="rules-btn">Rules</button>
        <button class="action-btn hint-btn" id="hint-btn">ðŸ’¡</button>
        <button class="action-btn sound-btn" id="sound-toggle-btn" onclick="toggleSound()">ðŸ”Š</button>
        <div class="target-score-info">
          ðŸŽ¯ Target<br>
          <span id="target-score">300 pts</span>
        </div>
        <div class="deck-info">
          ðŸ“š Deck<br>
          <span id="deck-count">40 cards</span>
        </div>
      </div>
    </div>

    <!-- Game Area -->
    <div class="game-area">
      <div class="current-player" id="current-player">Your Turn</div>
      <div class="board-label">BOARD</div>
      <div class="table" id="table">
        <div class="board" id="board">
          <!-- Board cards will be rendered here by your existing ui.js -->
        </div>
        
        <!-- Dealer indicator (preserved from your system) -->
        <div class="dealer-indicator" id="dealer-indicator">
          <span>DEALER</span>
        </div>
      </div>
      <div class="hand-wrapper">
        <div class="hand-label">YOUR HAND</div>
        <div class="player-hand" id="player-hand">
          <!-- Player cards will be rendered here by your existing ui.js -->
        </div>
      </div>
    </div>

    <!-- Combo Builder Area -->
    <div class="combo-area">
      <div class="combo-title">COMBO BUILDER</div>

      <!-- Base Card -->
      <div class="combo-section">
        <div class="combo-header">Base Card</div>
        <div class="base-area" data-slot="base" id="base-area"></div>
      </div>

      <!-- 4 Combo Slots in 2x2 grid (internal keys unchanged) -->
      <div class="combo-section">
        <div class="combo-header">Combo Slots</div>
        <div class="combo-grid">
          <div class="combo-slot-wrapper">
            <span class="combo-slot-label">1</span>
            <div class="sum-area" data-slot="sum1" id="sum1-area"></div>
          </div>
          <div class="combo-slot-wrapper">
            <span class="combo-slot-label">2</span>
            <div class="sum-area" data-slot="sum2" id="sum2-area"></div>
          </div>
          <div class="combo-slot-wrapper">
            <span class="combo-slot-label">3</span>
            <div class="sum-area" data-slot="sum3" id="sum3-area"></div>
          </div>
          <div class="combo-slot-wrapper">
            <span class="combo-slot-label">4</span>
            <div class="match-area" data-slot="match" id="match-area"></div>
          </div>
        </div>
      </div>

      <!-- Submit / Reset buttons -->
      <div class="combo-actions">
        <button class="action-btn" id="submit-btn" disabled>Submit</button>
        <button class="action-btn" id="reset-btn">Reset</button>
      </div>
    </div>
  </div>

  <!-- All your existing modals preserved -->
  <dialog id="scoreboard-modal">
    <div class="confetti-container" id="confetti-container"></div>
    <div class="jackpot-message" id="jackpot-message"></div>
    <div class="scoreboard">
      <div class="scoreboard-title" id="scoreboard-title">Scoreboard</div>
      <div class="scoreboard-list" id="scoreboard-list"></div>
    </div>
    <div class="scoreboard-buttons" id="scoreboard-buttons"></div>
  </dialog>

  <!-- Tutorial modal preserved -->
  <dialog id="tutorial-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>How to Play STACKED!</h2>
      </div>
      <div class="modal-body">
        <h3>Objective:</h3>
        <p>Be the first player to reach 300 points by capturing cards through strategic combinations!</p>
        
        <h3>How to Play:</h3>
        <ul>
          <li><strong>Game Setup:</strong> Each player starts with 4 cards in hand. 4 cards are placed on the board.</li>
          <li><strong>Your Turn:</strong> Drag cards to the play areas to build a combo:
            <ul>
              <li><strong>Pair Capture:</strong> Place a matching card (from hand or board) in the Principal Match area and a matching card in the Play Area. Both areas must include at least one hand card and one board card.</li>
              <li><strong>Sum Capture (2-10 only):</strong> Place the target card in the Principal Match area. In the Play Area, use at least one hand card and one board card whose sum equals the Principal Match card's value. All cards are captured.</li>
            </ul>
          </li>
          <li><strong>Submit Combo:</strong> Click "Submit Move" to capture. Both play areas will glow green if your combo is valid. You can make multiple combos per turn!</li>
          <li><strong>End Turn:</strong> Drag a hand card to the board to place it and end your turn.</li>
          <li><strong>Reset Play Area:</strong> Click "Reset Play Area" to return cards to their original positions.</li>
          <li><strong>Scoring:</strong> Number cards (2-9) are worth 5 points, 10/J/Q/K are worth 10 points, Aces are worth 15 points.</li>
          <li><strong>Game End:</strong> The game ends when the deck runs out. The player with the highest score wins!</li>
        </ul>
        <h3>Tips:</h3>
        <ul>
          <li>Plan your combos carefully to maximize points.</li>
          <li>Watch the botsâ€”they play smarter at higher difficulty levels!</li>
          <li>Secure J, Q, K matches quicklyâ€”they're valuable but can't be used in sums!</li>
        </ul>
      </div>
      <button type="button" onclick="document.getElementById('tutorial-modal').close()">Close</button>
    </div>
  </dialog>

  <!-- ðŸŽ¯ STACKED! Game Scripts - EXACT SAME ORDER! -->
  
  <!-- ðŸ”¥ CONSOLIDATED HELPERS (MUST BE FIRST!) -->
  <script src="js/helpers.js"></script>

  <!-- Core Dependencies -->
  <script src="js/cardIntelligence.js"></script>

  <!-- AI Personalities -->
  <script src="js/personalities/calvin.js"></script>
  <script src="js/personalities/nina.js"></script>
  <script src="js/personalities/rex.js"></script>

  <!-- ðŸŽ¯ GAME STATE MANAGER (CRITICAL FOR GAME FLOW!) -->
  <script src="js/gameStateManager.js"></script>

  <!-- ðŸŽª MODAL MANAGER (BEFORE UI SYSTEM!) -->
  <script src="js/modalManager.js"></script>

  <!-- Core Systems -->
  <script src="js/game.js"></script>
  <script src="js/modeSelector.js"></script>
  <script src="js/MessageController.js"></script>

  <!-- Game Modes -->
  <script src="js/classic.js"></script>
  <script src="js/speed.js"></script>

  <!-- AI Systems -->
  <script src="js/ai.js"></script>
  <script src="js/botModal.js"></script>

  <!-- UI System -->
  <script src="js/ui.js"></script>

  <!-- Hint System -->


  <!-- Main Controller (MUST BE LAST!) -->
  <script src="js/main.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').catch(() => {});
    }
  </script>
</body>
</html>